language: android
#jdk: oraclejdk8
sudo: required
#cache: false
#
#licenses:
#  - '.+'
#
#env:
#  global:
#    - MALLOC_ARENA_MAX=2
#    - ANDROID_API_LEVEL=27
#    - EMULATOR_API_LEVEL=23
#    - ANDROID_BUILD_TOOLS_VERSION=27.0.1
#    - ANDROID_ABI=armeabi-v7a
#    - ANDROID_TAG=google_apis
#    - ADB_INSTALL_TIMEOUT=20
#
#addons:
#  apt:
#    packages:
#      - oracle-java8-installer
#      - oracle-java8-set-default
#
android:
  components:
#    - tools # to get the new `repository-11.xml`
#    - platform-tools
#    - tools # to install Android SDK tools 25.1.x
#
#    - build-tools-$ANDROID_BUILD_TOOLS_VERSION
#    - android-$ANDROID_API_LEVEL
#    - android-$EMULATOR_API_LEVEL
#    # For Google APIs
#    - addon-google_apis-google-$ANDROID_API_LEVEL
#     addon-google_apis-google-$EMULATOR_API_LEVEL
#    # Google Play Services
#    - extra-google-google_play_services
#    # Support library
#    - extra-android-support
#    # Latest artifacts in local repository
#    - extra-google-m2repository
#    - extra-android-m2repository
#    # Specify at least one system image
#    # - sys-img-armeabi-v7a-google_apis-$ANDROID_API_LEVEL
#    - sys-img-armeabi-v7a-google_apis-$EMULATOR_API_LEVEL
     - android-22
     - sys-img-armeabi-v7a-android-22
     - sys-img-armeabi-v7a-android-17

before_install:
#  - java -version
#  - mkdir "$ANDROID_HOME/licenses" || true
#  - echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
#  - echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
#  - java -version
  - yes | sdkmanager "platforms;android-27"
#
before_script:
#  - java -version
#  - git clone https://github.com/urho3d/android-ndk.git $HOME/android-ndk-root
#  - export ANDROID_NDK_HOME=$HOME/android-ndk-root
  - chmod +x gradlew
#  - echo no | android create avd --force -n test -t "android-"$EMULATOR_API_LEVEL --abi $ANDROID_ABI --tag $ANDROID_TAG
#  - emulator -avd test -no-window &
#  - android-wait-for-emulator
#  - adb shell input keyevent 82 &

  - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
  - emulator -avd test -no-audio -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &

# adb shell am instrument -w -r -e package com.battlelancer.seriesguide -e debug false com.battlelancer.seriesguide.test/android.support.test.runner.AndroidJUnitRunner

script:
#   - ./gradlew androidDependencies
#   - ./gradlew sonarqube -Dsonar.organization=fabriziokruisland-github -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=907be43528cd29e5f06c94619337d33d12307900
    - adb push /Users/FabrizioKruisland/Desktop/projects/android/SeriesGuide/app/build/outputs/apk/androidTest/pure/debug/app-pure-debug-androidTest.apk /data/local/tmp/com.battlelancer.seriesguide.test
    - adb shell pm install -t -r "/data/local/tmp/com.battlelancer.seriesguide.test"
    - adb shell am instrument -w -r -e package com.battlelancer.seriesguide -e debug false com.battlelancer.seriesguide.test/android.support.test.runner.AndroidJUnitRunner
